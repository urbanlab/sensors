<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Sense::Daemon
  
    &mdash; Documentation by YARD 0.7.2
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  relpath = '..';
  if (relpath != '') relpath += '/';
</script>

  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <script type="text/javascript" charset="utf-8">
      if (window.top.frames.main) document.body.className = 'frames';
    </script>
    
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (D)</a> &raquo; 
    <span class='title'><span class='object_link'><a href="../Sense.html" title="Sense (module)">Sense</a></span></span>
     &raquo; 
    <span class="title">Daemon</span>
  
  
  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a id="class_list_link" href="#">Class List</a>
  
    <a id="method_list_link" href="#">Method List</a>
  
    <a id="file_list_link" href="#">File List</a>
  
</div>
      <div class="clear"></div>
    </div>
    
    <iframe id="search_frame"></iframe>
    
    <div id="content"><h1>Class: Sense::Daemon
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Sense::Daemon</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2"><span class='object_link'><a href="Common.html" title="Sense::Common (module)">Common</a></span></dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">lib/sense/daemon.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
Contain methods userful for the daemon : multiplexer&#8217;s registration
and dynamic callbacks of clients&#8217; messages Use it to implement a new
daemon
</p>


  </div>
</div>
<div class="tags">
  
</div>
  <h2>Constant Summary</h2>
  


  
  
  
  
  <h3 class="inherited">Constants included from <span class='object_link'><a href="Common.html" title="Sense::Common (module)">Common</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Common.html#CONFIG-constant" title="Sense::Common::CONFIG (constant)">CONFIG</a></span>, <span class='object_link'><a href="Common.html#PREFIX-constant" title="Sense::Common::PREFIX (constant)">PREFIX</a></span>, <span class='object_link'><a href="Common.html#PROFILE-constant" title="Sense::Common::PROFILE (constant)">PROFILE</a></span></p>



  
  
  

  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#clean_up-instance_method" title="#clean_up (instance method)">- (Object) <strong>clean_up</strong>(multi_id) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Clean up a multiplexer&#8217;s sensors and actuators.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#flushdb-instance_method" title="#flushdb (instance method)">- (Object) <strong>flushdb</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Destroy the entire database and configuration.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_unassigned_id-instance_method" title="#get_unassigned_id (instance method)">- (Integer) <strong>get_unassigned_id</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Get an unassigned id.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Daemon) <strong>initialize</strong>(network, host = 'localhost', port = 6379, logger = Logger.new(nil)) </a>
    

    
  </span>
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Initialization of the client.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_actuator_state-instance_method" title="#on_actuator_state (instance method)">- (Object) <strong>on_actuator_state</strong> {|multi_id, pin, value| ... }</a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Callback when a client request to change the state of an actuator.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_deleted_actuator-instance_method" title="#on_deleted_actuator (instance method)">- (Object) <strong>on_deleted_actuator</strong> {|multi_id, pin| ... }</a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Callback when a client request to delete an actuator.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_deleted_sensor-instance_method" title="#on_deleted_sensor (instance method)">- (Object) <strong>on_deleted_sensor</strong> {|multi_id, pin| ... }</a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Callback when a client request to delete a sensor.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_new_actuator-instance_method" title="#on_new_actuator (instance method)">- (Object) <strong>on_new_actuator</strong> {|multi_id, pin, function, period, *[option1, option2]| ... }</a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Callback when a client request to add an actu.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_new_sensor-instance_method" title="#on_new_sensor (instance method)">- (Object) <strong>on_new_sensor</strong> {|multi_id, pin, function, period, *[option1, option2]| ... }</a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Callback when a client request to add a sensor.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_taken-instance_method" title="#on_taken (instance method)">- (Object) <strong>on_taken</strong> {|id_multi, network| ... }</a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Callback when a client request to take a sensor.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process_messages-instance_method" title="#process_messages (instance method)">- (Object) <strong>process_messages</strong> </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Read the messages from the client and call the callbacks.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#publish_value-instance_method" title="#publish_value (instance method)">- (Object) <strong>publish_value</strong>(multi_id, sensor, raw_value) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Publish a sensor&#8217;s value.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_multi_config-instance_method" title="#set_multi_config (instance method)">- (Object) <strong>set_multi_config</strong>(multi_id, config) </a>
    

    
  </span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Assign a config to a multiplexer.
</p>
</div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="Common.html" title="Sense::Common (module)">Common</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="Common.html#get_actuator_state-instance_method" title="Sense::Common#get_actuator_state (method)">#get_actuator_state</a></span>, <span class='object_link'><a href="Common.html#get_config-instance_method" title="Sense::Common#get_config (method)">#get_config</a></span>, <span class='object_link'><a href="Common.html#get_multi_config-instance_method" title="Sense::Common#get_multi_config (method)">#get_multi_config</a></span>, <span class='object_link'><a href="Common.html#get_multi_id-instance_method" title="Sense::Common#get_multi_id (method)">#get_multi_id</a></span>, <span class='object_link'><a href="Common.html#get_pin-instance_method" title="Sense::Common#get_pin (method)">#get_pin</a></span>, <span class='object_link'><a href="Common.html#get_profile-instance_method" title="Sense::Common#get_profile (method)">#get_profile</a></span>, <span class='object_link'><a href="Common.html#get_sensor_value-instance_method" title="Sense::Common#get_sensor_value (method)">#get_sensor_value</a></span>, <span class='object_link'><a href="Common.html#knows%3F-instance_method" title="Sense::Common#knows? (method)">#knows?</a></span>, <span class='object_link'><a href="Common.html#knows_multi%3F-instance_method" title="Sense::Common#knows_multi? (method)">#knows_multi?</a></span>, <span class='object_link'><a href="Common.html#knows_profile%3F-instance_method" title="Sense::Common#knows_profile? (method)">#knows_profile?</a></span>, <span class='object_link'><a href="Common.html#list-instance_method" title="Sense::Common#list (method)">#list</a></span>, <span class='object_link'><a href="Common.html#list_multis-instance_method" title="Sense::Common#list_multis (method)">#list_multis</a></span>, <span class='object_link'><a href="Common.html#list_profiles-instance_method" title="Sense::Common#list_profiles (method)">#list_profiles</a></span>, <span class='object_link'><a href="Common.html#load-instance_method" title="Sense::Common#load (method)">#load</a></span>, <span class='object_link'><a href="Common.html#mine%3F-instance_method" title="Sense::Common#mine? (method)">#mine?</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <p class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Sense::Daemon (class)">Daemon</a></span></tt>) <strong>initialize</strong>(network, host = 'localhost', port = 6379, logger = Logger.new(nil)) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Initialization of the client.
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>network</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The identifier of the network the demon will work on.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>host</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
        <em class="default">(defaults to: <tt>'localhost'</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
The adress of the machine where Redis is running
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>port</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>6379</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
Port where Redis listen
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>logger</span>
      
      
        <span class='type'>(<tt>Logger</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>Logger.new(nil)</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
An optional Logger to write redis related events.
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


17
18
19
20
21
22</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sense/daemon.rb', line 17</span>

<span class='kw'>def</span> <span class='id initialize'>initialize</span><span class='lparen'>(</span><span class='id network'>network</span><span class='comma'>,</span> <span class='id host'>host</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>localhost</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='id port'>port</span> <span class='op'>=</span> <span class='int'>6379</span><span class='comma'>,</span> <span class='id logger'>logger</span> <span class='op'>=</span> <span class='const'>Logger</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='rparen'>)</span><span class='rparen'>)</span>
	<span class='id load'>load</span><span class='lparen'>(</span><span class='id network'>network</span><span class='comma'>,</span> <span class='id host'>host</span><span class='comma'>,</span> <span class='id port'>port</span><span class='rparen'>)</span>
	<span class='ivar'>@redis_listener</span> <span class='op'>=</span> <span class='const'>Redis</span><span class='period'>.</span><span class='id new'>new</span> <span class='label'>host:</span> <span class='id host'>host</span><span class='comma'>,</span> <span class='label'>port:</span> <span class='id port'>port</span><span class='comma'>,</span> <span class='label'>thread_safe:</span> <span class='kw'>false</span>
	<span class='ivar'>@log</span> <span class='op'>=</span> <span class='id logger'>logger</span>
	<span class='ivar'>@failed_cmds</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id new'>new</span><span class='lparen'>(</span><span class='int'>10</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>
    
    
      <div class="method_details first">
  <p class="signature first" id="clean_up-instance_method">
  
    - (<tt>Object</tt>) <strong>clean_up</strong>(multi_id) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Clean up a multiplexer&#8217;s sensors and actuators
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>multi_id</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Id of the multi to be cleaned
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


34
35
36
37
38
39
40</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sense/daemon.rb', line 34</span>

<span class='kw'>def</span> <span class='id clean_up'>clean_up</span><span class='lparen'>(</span><span class='id multi_id'>multi_id</span><span class='rparen'>)</span>
	<span class='id net'>net</span> <span class='op'>=</span> <span class='id get_multi_config'>get_multi_config</span><span class='lparen'>(</span><span class='id multi_id'>multi_id</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='symbol'>:network</span><span class='rbracket'>]</span>
	<span class='ivar'>@redis</span><span class='period'>.</span><span class='id del'>del</span><span class='lparen'>(</span><span class='id network_path'>network_path</span><span class='lparen'>(</span><span class='id net'>net</span><span class='comma'>,</span> <span class='symbol'>:sensor</span><span class='comma'>,</span> <span class='symbol'>:value</span><span class='comma'>,</span> <span class='id multi_id'>multi_id</span><span class='rparen'>)</span><span class='rparen'>)</span>
	<span class='ivar'>@redis</span><span class='period'>.</span><span class='id del'>del</span><span class='lparen'>(</span><span class='id network_path'>network_path</span><span class='lparen'>(</span><span class='id net'>net</span><span class='comma'>,</span> <span class='symbol'>:actuator</span><span class='comma'>,</span> <span class='symbol'>:value</span><span class='comma'>,</span> <span class='id multi_id'>multi_id</span><span class='rparen'>)</span><span class='rparen'>)</span>
	<span class='ivar'>@redis</span><span class='period'>.</span><span class='id del'>del</span><span class='lparen'>(</span><span class='id network_path'>network_path</span><span class='lparen'>(</span><span class='id net'>net</span><span class='comma'>,</span> <span class='symbol'>:sensor</span><span class='comma'>,</span> <span class='symbol'>:config</span><span class='comma'>,</span> <span class='id multi_id'>multi_id</span><span class='rparen'>)</span><span class='rparen'>)</span>
	<span class='ivar'>@redis</span><span class='period'>.</span><span class='id del'>del</span><span class='lparen'>(</span><span class='id network_path'>network_path</span><span class='lparen'>(</span><span class='id net'>net</span><span class='comma'>,</span> <span class='symbol'>:actuator</span><span class='comma'>,</span> <span class='symbol'>:config</span><span class='comma'>,</span> <span class='id multi_id'>multi_id</span><span class='rparen'>)</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="flushdb-instance_method">
  
    - (<tt>Object</tt>) <strong>flushdb</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Destroy the entire database and configuration
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


26
27
28
29</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sense/daemon.rb', line 26</span>

<span class='kw'>def</span> <span class='id flushdb'>flushdb</span>
	<span class='ivar'>@redis</span><span class='period'>.</span><span class='id flushdb'>flushdb</span>
	<span class='ivar'>@log</span><span class='period'>.</span><span class='id info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Flushing database</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="get_unassigned_id-instance_method">
  
    - (<tt>Integer</tt>) <strong>get_unassigned_id</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Get an unassigned id
</p>


  </div>
</div>
<div class="tags">
  <h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the id
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


52
53
54
55</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sense/daemon.rb', line 52</span>

<span class='kw'>def</span> <span class='id get_unassigned_id'>get_unassigned_id</span>
	<span class='id ids'>ids</span> <span class='op'>=</span> <span class='ivar'>@redis</span><span class='period'>.</span><span class='id hkeys'>hkeys</span><span class='lparen'>(</span><span class='id path'>path</span><span class='lparen'>(</span><span class='rparen'>)</span><span class='rparen'>)</span><span class='period'>.</span><span class='id inject'>inject</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id a'>a</span><span class='comma'>,</span><span class='id i'>i</span><span class='op'>|</span><span class='id a'>a</span> <span class='op'>&lt;&lt;</span> <span class='id i'>i</span><span class='period'>.</span><span class='id to_i'>to_i</span><span class='rbrace'>}</span>
	<span class='lparen'>(</span><span class='const'>Array</span><span class='lparen'>(</span><span class='int'>1</span><span class='op'>..</span><span class='int'>255</span><span class='rparen'>)</span> <span class='op'>-</span> <span class='id ids'>ids</span><span class='rparen'>)</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="on_actuator_state-instance_method">
  
    - (<tt>Object</tt>) <strong>on_actuator_state</strong> {|multi_id, pin, value| ... }
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Callback when a client request to change the state of an actuator
</p>


  </div>
</div>
<div class="tags">
  <h3>Yields:</h3>
<ul class="yield">
  
    <li>
      
      
        <span class='type'>(<tt>multi_id</tt>, <tt>pin</tt>, <tt>value</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Action to change the state of an actuator
</p>
</div>
      
    </li>
  
</ul>
<h3>Yield Returns:</h3>
<ul class="yieldreturn">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'><p>
True if it was a sucess, False if not, nil if nobody answered
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


140
141
142</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sense/daemon.rb', line 140</span>

<span class='kw'>def</span> <span class='id on_actuator_state'>on_actuator_state</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
	<span class='ivar'>@on_actuator_state</span> <span class='op'>=</span> <span class='id block'>block</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="on_deleted_actuator-instance_method">
  
    - (<tt>Object</tt>) <strong>on_deleted_actuator</strong> {|multi_id, pin| ... }
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Callback when a client request to delete an actuator
</p>


  </div>
</div>
<div class="tags">
  <h3>Yields:</h3>
<ul class="yield">
  
    <li>
      
      
        <span class='type'>(<tt>multi_id</tt>, <tt>pin</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Action to do when a client request to delete a device on a pin of the
multiplexer multi_id
</p>
</div>
      
    </li>
  
</ul>
<h3>Yield Returns:</h3>
<ul class="yieldreturn">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'><p>
True if the destruction was accepted, False if not, nil if nobody answered
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


132
133
134</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sense/daemon.rb', line 132</span>

<span class='kw'>def</span> <span class='id on_deleted_actuator'>on_deleted_actuator</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
	<span class='ivar'>@on_deleted_actuator</span> <span class='op'>=</span> <span class='id block'>block</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="on_deleted_sensor-instance_method">
  
    - (<tt>Object</tt>) <strong>on_deleted_sensor</strong> {|multi_id, pin| ... }
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Callback when a client request to delete a sensor
</p>


  </div>
</div>
<div class="tags">
  <h3>Yields:</h3>
<ul class="yield">
  
    <li>
      
      
        <span class='type'>(<tt>multi_id</tt>, <tt>pin</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Action to do when a client request to delete a device on a pin of the
multiplexer multi_id
</p>
</div>
      
    </li>
  
</ul>
<h3>Yield Returns:</h3>
<ul class="yieldreturn">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'><p>
True if the destruction was accepted, False if not, nil if nobody answered
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


124
125
126</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sense/daemon.rb', line 124</span>

<span class='kw'>def</span> <span class='id on_deleted_sensor'>on_deleted_sensor</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id block'>block</span><span class='rparen'>)</span>
	<span class='ivar'>@on_deleted_sensor</span> <span class='op'>=</span> <span class='id block'>block</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="on_new_actuator-instance_method">
  
    - (<tt>Object</tt>) <strong>on_new_actuator</strong> {|multi_id, pin, function, period, *[option1, option2]| ... }
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Callback when a client request to add an actu
</p>


  </div>
</div>
<div class="tags">
  <h3>Yields:</h3>
<ul class="yield">
  
    <li>
      
      
        <span class='type'>(<tt>multi_id</tt>, <tt>pin</tt>, <tt>function</tt>, <tt>period</tt>, <tt>*[option1, option2]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Block will be called when a client request a new actuator with
client&#8217;s parameters
</p>
</div>
      
    </li>
  
</ul>
<h3>Yield Returns:</h3>
<ul class="yieldreturn">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'><p>
True if the new actuator is accepted, False if not, nil if nobody answered
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


116
117
118</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sense/daemon.rb', line 116</span>

<span class='kw'>def</span> <span class='id on_new_actuator'>on_new_actuator</span> <span class='op'>&amp;</span><span class='id block'>block</span>
	<span class='ivar'>@on_new_actuator</span> <span class='op'>=</span> <span class='id block'>block</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="on_new_sensor-instance_method">
  
    - (<tt>Object</tt>) <strong>on_new_sensor</strong> {|multi_id, pin, function, period, *[option1, option2]| ... }
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Callback when a client request to add a sensor
</p>


  </div>
</div>
<div class="tags">
  <h3>Yields:</h3>
<ul class="yield">
  
    <li>
      
      
        <span class='type'>(<tt>multi_id</tt>, <tt>pin</tt>, <tt>function</tt>, <tt>period</tt>, <tt>*[option1, option2]</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Block will be called when a client request a new sensor with client&#8217;s
parameters
</p>
</div>
      
    </li>
  
</ul>
<h3>Yield Returns:</h3>
<ul class="yieldreturn">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'><p>
True if the new sensor is accepted, False if not, nil if nobody answered
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


108
109
110</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sense/daemon.rb', line 108</span>

<span class='kw'>def</span> <span class='id on_new_sensor'>on_new_sensor</span> <span class='op'>&amp;</span><span class='id block'>block</span>
	<span class='ivar'>@on_new_sensor</span> <span class='op'>=</span> <span class='id block'>block</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="on_taken-instance_method">
  
    - (<tt>Object</tt>) <strong>on_taken</strong> {|id_multi, network| ... }
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Callback when a client request to take a sensor
</p>


  </div>
</div>
<div class="tags">
  <h3>Yields:</h3>
<ul class="yield">
  
    <li>
      
      
        <span class='type'>(<tt>id_multi</tt>, <tt>network</tt>)</span>
      
      
      
    </li>
  
</ul>
<h3>Yield Returns:</h3>
<ul class="yieldreturn">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'><p>
True if it was taken, False if not, nil if nobody answered
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


148
149
150</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sense/daemon.rb', line 148</span>

<span class='kw'>def</span> <span class='id on_taken'>on_taken</span> <span class='op'>&amp;</span><span class='id block'>block</span>
	<span class='ivar'>@on_taken</span> <span class='op'>=</span> <span class='id block'>block</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="process_messages-instance_method">
  
    - (<tt>Object</tt>) <strong>process_messages</strong> 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Read the messages from the client and call the callbacks
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sense/daemon.rb', line 154</span>

<span class='kw'>def</span> <span class='id process_messages'>process_messages</span>
	<span class='kw'>while</span> <span class='kw'>true</span>
		<span class='id chan'>chan</span><span class='comma'>,</span> <span class='id message'>message</span> <span class='op'>=</span> <span class='ivar'>@redis_listener</span><span class='period'>.</span><span class='id blpop'>blpop</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>PREFIX</span><span class='rbrace'>}</span><span class='tstring_content'>.network:</span><span class='embexpr_beg'>#{</span><span class='ivar'>@network</span><span class='rbrace'>}</span><span class='tstring_content'>.messages</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span>
		<span class='ivar'>@log</span><span class='period'>.</span><span class='id debug'>debug</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>A client sent the message : </span><span class='embexpr_beg'>#{</span><span class='id message'>message</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
		<span class='id msgid'>msgid</span><span class='comma'>,</span> <span class='id command'>command</span><span class='comma'>,</span> <span class='id args'>args</span> <span class='op'>=</span> <span class='id parse'>parse</span><span class='lparen'>(</span><span class='id message'>message</span><span class='rparen'>)</span>
		<span class='kw'>unless</span> <span class='id command'>command</span>
			<span class='ivar'>@log</span><span class='period'>.</span><span class='id warn'>warn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>A client sent an invalid message.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
			<span class='kw'>next</span>
		<span class='kw'>end</span>
		
		<span class='id ans'>ans</span><span class='comma'>,</span> <span class='id info'>info</span> <span class='op'>=</span> <span class='kw'>case</span> <span class='id command'>command</span>
			<span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>add_sensor</span><span class='tstring_end'>&quot;</span></span>
				<span class='id register_device'>register_device</span> <span class='symbol'>:sensor</span><span class='comma'>,</span> <span class='id args'>args</span>
			<span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>add_actuator</span><span class='tstring_end'>&quot;</span></span>
				<span class='id register_device'>register_device</span> <span class='symbol'>:actuator</span><span class='comma'>,</span> <span class='id args'>args</span>
			<span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>delete_sensor</span><span class='tstring_end'>&quot;</span></span>
				<span class='id unregister_device'>unregister_device</span> <span class='symbol'>:sensor</span><span class='comma'>,</span> <span class='id args'>args</span>
			<span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>delete_actuator</span><span class='tstring_end'>&quot;</span></span>
				<span class='id unregister_device'>unregister_device</span> <span class='symbol'>:actuator</span><span class='comma'>,</span> <span class='id args'>args</span>
			<span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>take</span><span class='tstring_end'>&quot;</span></span>
				<span class='id take_callback'>take_callback</span> <span class='id args'>args</span>
			<span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>actuator_state</span><span class='tstring_end'>&quot;</span></span>
				<span class='id actuator_state_callback'>actuator_state_callback</span> <span class='id args'>args</span>
			<span class='kw'>else</span>
				<span class='ivar'>@log</span><span class='period'>.</span><span class='id warn'>warn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>A client sent an unknown command : \&quot;</span><span class='embexpr_beg'>#{</span><span class='id command'>command</span><span class='rbrace'>}</span><span class='tstring_content'>\&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
				<span class='lbracket'>[</span><span class='kw'>false</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unknown command \&quot;</span><span class='embexpr_beg'>#{</span><span class='id command'>command</span><span class='rbrace'>}</span><span class='tstring_content'>\&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
		<span class='kw'>end</span>
		<span class='kw'>case</span> <span class='id ans'>ans</span>
			<span class='kw'>when</span> <span class='kw'>true</span>  <span class='comment'># Success
</span>				<span class='id answer'>answer</span><span class='lparen'>(</span><span class='id msgid'>msgid</span><span class='comma'>,</span> <span class='kw'>true</span><span class='rparen'>)</span>
			<span class='kw'>when</span> <span class='kw'>false</span> <span class='comment'># Failure
</span>				<span class='id answer'>answer</span><span class='lparen'>(</span><span class='id msgid'>msgid</span><span class='comma'>,</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='id info'>info</span><span class='rparen'>)</span>
			<span class='kw'>else</span>       <span class='comment'># Timeout error
</span>				<span class='kw'>if</span> <span class='ivar'>@failed_cmds</span><span class='period'>.</span><span class='id include?'>include?</span> <span class='id msgid'>msgid</span> <span class='comment'># Every daemon tries (blpop act as first waiting, first served)
</span>					<span class='id answer'>answer</span><span class='lparen'>(</span><span class='id msgid'>msgid</span><span class='comma'>,</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No daemon could contact the multiplexer</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
				<span class='kw'>else</span>                           <span class='comment'># transmit to another daemon
</span>					<span class='kw'>if</span> <span class='kw'>not</span> <span class='id msgid'>msgid</span>			   <span class='comment'># Generate an id only for daemons
</span>						<span class='id msgid'>msgid</span> <span class='op'>=</span> <span class='id rand'>rand</span><span class='period'>.</span><span class='id hash'>hash</span><span class='period'>.</span><span class='id abs'>abs</span>
						<span class='id message'>message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id msgid'>msgid</span><span class='rbrace'>}</span><span class='tstring_content'>:message</span><span class='tstring_end'>&quot;</span></span>
					<span class='kw'>end</span>
					<span class='ivar'>@failed_cmds</span><span class='period'>.</span><span class='id push'>push</span><span class='lparen'>(</span><span class='id msgid'>msgid</span><span class='rparen'>)</span><span class='period'>.</span><span class='id unshift'>unshift</span>
					<span class='comment'>#answer(msgid, false, &quot;wait&quot;) # TODO utile ?
</span>					<span class='ivar'>@redis_listener</span><span class='period'>.</span><span class='id lpush'>lpush</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='const'>PREFIX</span><span class='rbrace'>}</span><span class='tstring_content'>.network:</span><span class='embvar'>#</span><span class='ivar'>@network</span><span class='tstring_content'>.messages</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id message'>message</span><span class='rparen'>)</span> <span class='comment'>#TODO generate with path?
</span>				<span class='kw'>end</span>
		<span class='kw'>end</span>
	<span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="publish_value-instance_method">
  
    - (<tt>Object</tt>) <strong>publish_value</strong>(multi_id, sensor, raw_value) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Publish a sensor&#8217;s value
</p>


  </div>
</div>
<div class="tags">
  <h3>Parameters:</h3>
<ul class="param">
  
    <li>
      
        <span class='name'>multi_id</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Id of the multiplexer that got the value
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>sensor</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Pin of the sensor
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>raw_value</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
unormalized value
</p>
</div>
      
    </li>
  
</ul>
<h3>Returns:</h3>
<ul class="return">
  
    <li>
      
      
        <span class='type'></span>
      
      
      
        
        <div class='inline'><p>
true if the value was succefully published. false with log otherwise
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sense/daemon.rb', line 63</span>

<span class='kw'>def</span> <span class='id publish_value'>publish_value</span><span class='lparen'>(</span><span class='id multi_id'>multi_id</span><span class='comma'>,</span> <span class='id sensor'>sensor</span><span class='comma'>,</span> <span class='id raw_value'>raw_value</span><span class='rparen'>)</span>
	<span class='kw'>return</span> <span class='kw'>false</span> <span class='kw'>unless</span> <span class='id knows?'>knows?</span> <span class='symbol'>:sensor</span><span class='comma'>,</span> <span class='id multi_id'>multi_id</span><span class='comma'>,</span> <span class='id sensor'>sensor</span>
	<span class='id path'>path</span> <span class='op'>=</span> <span class='id path'>path</span><span class='lparen'>(</span><span class='symbol'>:sensor</span><span class='comma'>,</span> <span class='symbol'>:value</span><span class='comma'>,</span> <span class='id multi_id'>multi_id</span><span class='comma'>,</span> <span class='id sensor'>sensor</span><span class='rparen'>)</span>
	<span class='id config'>config</span> <span class='op'>=</span> <span class='id get_config'>get_config</span><span class='lparen'>(</span><span class='symbol'>:sensor</span><span class='comma'>,</span> <span class='id multi_id'>multi_id</span><span class='comma'>,</span> <span class='id sensor'>sensor</span><span class='rparen'>)</span>
	<span class='kw'>if</span> <span class='id config'>config</span> <span class='op'>==</span> <span class='kw'>nil</span>
		<span class='ivar'>@log</span><span class='period'>.</span><span class='id error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Tried to publish a value from an unknown multiplexer : </span><span class='embexpr_beg'>#{</span><span class='id multi_id'>multi_id</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
		<span class='kw'>return</span> <span class='kw'>false</span>
	<span class='kw'>end</span>
	<span class='id profile'>profile</span> <span class='op'>=</span> <span class='id get_profile'>get_profile</span><span class='lparen'>(</span><span class='symbol'>:sensor</span><span class='comma'>,</span> <span class='id config'>config</span><span class='lbracket'>[</span><span class='symbol'>:profile</span><span class='rbracket'>]</span><span class='rparen'>)</span>
	<span class='kw'>if</span> <span class='id profile'>profile</span> <span class='op'>==</span> <span class='kw'>nil</span>
		<span class='ivar'>@log</span><span class='period'>.</span><span class='id error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Tried to publish a value from an unknown profile : </span><span class='embexpr_beg'>#{</span><span class='id config'>config</span><span class='lbracket'>[</span><span class='symbol'>:profile</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_content'> (multiplexer : </span><span class='embexpr_beg'>#{</span><span class='id multi_id'>multi_id</span><span class='rbrace'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
		<span class='kw'>return</span> <span class='kw'>false</span>
	<span class='kw'>end</span>
	<span class='kw'>if</span> <span class='id profile'>profile</span><span class='lbracket'>[</span><span class='symbol'>:rpn</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id is_a?'>is_a?</span> <span class='const'>String</span>
		<span class='id rpn'>rpn</span> <span class='op'>=</span> <span class='id profile'>profile</span><span class='lbracket'>[</span><span class='symbol'>:rpn</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id sub'>sub</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>X</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id raw_value'>raw_value</span><span class='period'>.</span><span class='id to_s'>to_s</span><span class='rparen'>)</span>
		<span class='kw'>begin</span>
			<span class='id value'>value</span> <span class='op'>=</span> <span class='id solve_rpn'>solve_rpn</span><span class='lparen'>(</span><span class='id rpn'>rpn</span><span class='rparen'>)</span>
		<span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id e'>e</span>
			<span class='ivar'>@log</span><span class='period'>.</span><span class='id error'>error</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Tried to publish a value with an icorrect rpn : </span><span class='embexpr_beg'>#{</span><span class='id profile'>profile</span><span class='lbracket'>[</span><span class='symbol'>:rpn</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_content'> from </span><span class='embexpr_beg'>#{</span><span class='id config'>config</span><span class='lbracket'>[</span><span class='symbol'>:profile</span><span class='rbracket'>]</span><span class='rbrace'>}</span><span class='tstring_content'>. Error : </span><span class='embexpr_beg'>#{</span><span class='id e'>e</span><span class='period'>.</span><span class='id message'>message</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
			<span class='kw'>return</span> <span class='kw'>false</span>
		<span class='kw'>end</span>
	<span class='kw'>else</span>
		<span class='id value'>value</span> <span class='op'>=</span> <span class='id raw_value'>raw_value</span>
	<span class='kw'>end</span>
	<span class='kw'>if</span> <span class='id profile'>profile</span><span class='lbracket'>[</span><span class='symbol'>:precision</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id is_a?'>is_a?</span> <span class='const'>Integer</span>
		<span class='id value'>value</span> <span class='op'>=</span> <span class='id value'>value</span><span class='period'>.</span><span class='id round'>round</span> <span class='id profile'>profile</span><span class='lbracket'>[</span><span class='symbol'>:precision</span><span class='rbracket'>]</span>
	<span class='kw'>end</span>
	<span class='id key'>key</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='label'>value:</span> <span class='id value'>value</span><span class='comma'>,</span> <span class='label'>timestamp:</span> <span class='const'>Time</span><span class='period'>.</span><span class='id now'>now</span><span class='period'>.</span><span class='id to_f'>to_f</span><span class='comma'>,</span> <span class='label'>unit:</span> <span class='id profile'>profile</span><span class='lbracket'>[</span><span class='symbol'>:unit</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>name:</span> <span class='id config'>config</span><span class='lbracket'>[</span><span class='symbol'>:name</span><span class='rbracket'>]</span><span class='rbrace'>}</span>
	<span class='id old_value'>old_value</span><span class='comma'>,</span> <span class='id set'>set</span> <span class='op'>=</span> <span class='ivar'>@redis</span><span class='period'>.</span><span class='id multi'>multi</span> <span class='kw'>do</span>
		<span class='ivar'>@redis</span><span class='period'>.</span><span class='id hget'>hget</span><span class='lparen'>(</span><span class='id path'>path</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>value</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
		<span class='ivar'>@redis</span><span class='period'>.</span><span class='id mapped_hmset'>mapped_hmset</span><span class='lparen'>(</span><span class='id path'>path</span><span class='comma'>,</span> <span class='id key'>key</span><span class='rparen'>)</span>
		
	<span class='kw'>end</span>
	<span class='id old_value'>old_value</span> <span class='op'>=</span> <span class='id old_value'>old_value</span><span class='period'>.</span><span class='id to_f'>to_f</span> <span class='kw'>if</span> <span class='id old_value'>old_value</span>
	<span class='kw'>if</span> <span class='lparen'>(</span><span class='id old_value'>old_value</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='id old_value'>old_value</span> <span class='op'>!=</span> <span class='id key'>key</span><span class='lbracket'>[</span><span class='symbol'>:value</span><span class='rbracket'>]</span><span class='rparen'>)</span>
		<span class='ivar'>@redis</span><span class='period'>.</span><span class='id publish'>publish</span><span class='lparen'>(</span><span class='id path'>path</span><span class='lparen'>(</span><span class='symbol'>:sensor</span><span class='comma'>,</span> <span class='symbol'>:raw_value</span><span class='comma'>,</span> <span class='id multi_id'>multi_id</span><span class='comma'>,</span> <span class='id sensor'>sensor</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id value'>value</span><span class='rparen'>)</span>
		<span class='ivar'>@redis</span><span class='period'>.</span><span class='id publish'>publish</span><span class='lparen'>(</span><span class='id path'>path</span><span class='comma'>,</span> <span class='id key'>key</span><span class='period'>.</span><span class='id to_json'>to_json</span><span class='rparen'>)</span>
	<span class='kw'>end</span>
	<span class='kw'>return</span> <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <p class="signature " id="set_multi_config-instance_method">
  
    - (<tt>Object</tt>) <strong>set_multi_config</strong>(multi_id, config) 
  

  
</p><div class="docstring">
  <div class="discussion">
    <p>
Assign a config to a multiplexer
</p>


  </div>
</div>
<div class="tags">
  
</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


44
45
46
47</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/sense/daemon.rb', line 44</span>

<span class='kw'>def</span> <span class='id set_multi_config'>set_multi_config</span> <span class='id multi_id'>multi_id</span><span class='comma'>,</span> <span class='id config'>config</span>
	<span class='ivar'>@redis</span><span class='period'>.</span><span class='id hset'>hset</span><span class='lparen'>(</span><span class='id path'>path</span><span class='lparen'>(</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id multi_id'>multi_id</span><span class='comma'>,</span> <span class='id config'>config</span><span class='period'>.</span><span class='id to_json'>to_json</span><span class='rparen'>)</span>
	<span class='ivar'>@log</span><span class='period'>.</span><span class='id debug'>debug</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Registering multiplexer's configuration : </span><span class='embexpr_beg'>#{</span><span class='id config'>config</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>
    
    <div id="footer">
  Generated on Thu Aug 25 17:40:28 2011 by 
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.7.2 (ruby-1.9.2).
</div>

  </body>
</html>